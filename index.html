<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Voice Room</title>
  <script src="https://download.agora.io/sdk/release/AgoraRTC_N.js"></script>
  <style>
    body {
      margin: 0;
      padding: 8px;
      font-family: -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
      background: #ffffff;
      color: #222;
    }
    .wrapper {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 8px;
    }
    h2 {
      margin: 0 0 4px 0;
      font-size: 18px;
    }
    .buttons {
      display: flex;
      gap: 8px;
    }
    button {
      border: none;
      border-radius: 18px;
      padding: 6px 12px;
      font-size: 14px;
      cursor: pointer;
    }
    .join {
      background: #00b894;
      color: white;
    }
    .leave {
      background: #eeeeee;
      color: #444;
    }
    .room-label {
      font-size: 12px;
      color: #777;
    }
  </style>
</head>

<body>
  <div class="wrapper">
    <h2>Voice Room l√§uft üöÄ</h2>
    <div class="room-label" id="roomLabel"></div>

    <div class="buttons">
      <button class="join" onclick="join()">üîä Beitreten</button>
      <button class="leave" onclick="leave()">‚ùå Verlassen</button>
    </div>
  </div>

  <script>
    // Agora Daten
    const appId  = "a393d43e6ca144c7a9f3146ffa414aac";
    const token  = "007eJxTYIguO7XkTEW4TkTPz7/vvT447lN44Ppdv/kmw6vayNIfywwVGBKNLY1TTIxTzZITDU1Mks0TLdOMDU3M0tISTQxNEhOTv742zGwIZGSonnKPkZEBAkF8DoaS1OKSovz8XAYGAMFXJL8=";

    // Channel aus URL lesen (?room=XYZ)
    const params = new URLSearchParams(window.location.search);
    const channel = params.get("room") || "testroom";

    // Anzeige des Channel-Namens
    document.getElementById("roomLabel").innerText = "Channel: " + channel;

    const client = AgoraRTC.createClient({ mode: "rtc", codec: "vp8" });
    let localAudioTrack;

    async function join(){
      try{
        await client.join(appId, channel, token, null);
        localAudioTrack = await AgoraRTC.createMicrophoneAudioTrack();
        await client.publish(localAudioTrack);
        alert("Du bist jetzt im Voice Room üé§");
      }catch(e){
        alert("‚ùå Fehler beim Join: " + e.message);
      }
    }

    async function leave(){
      try{
        if(localAudioTrack){
          localAudioTrack.stop();
          localAudioTrack.close();
        }
        await client.leave();
        alert("Du hast den Raum verlassen");
      }catch(e){
        alert("‚ùå Fehler beim Verlassen: " + e.message);
      }
    }
  </script>
</body>
</html>
