<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Voice Room</title>

  <!-- Für Mobile-Ansicht (wichtig für FlutterFlow-WebView) -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

  <!-- ZEGOCLOUD UIKit Prebuilt (offizielle CDN-URL) -->
  <script src="https://unpkg.com/zego-uikit-prebuilt/zego-uikit-prebuilt.js"></script>

  <!-- Dark Premium Look -->
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      overflow: hidden;
      background: #050814;      /* dunkles Blau/Schwarz */
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;
      color: #ffffff;
    }

    #root {
      width: 100vw;
      height: 100vh;
      box-sizing: border-box;
      background: #050814;
      border-top: 3px solid #F4C042; /* Gold-Akzent oben */
    }

    .error {
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      height: 100%;
      width: 100%;
      color: #ffdd66;
      padding: 16px;
      box-sizing: border-box;
      font-size: 16px;
      line-height: 1.4;
    }

    button {
      font-family: inherit;
    }
  </style>
</head>

<body>
  <!-- Container für das Zego UI -->
  <div id="root"></div>

  <script>
    // --------- Hilfsfunktion: Query-Parameter auslesen ----------
    function getQueryParam(name) {
      const params = new URLSearchParams(window.location.search);
      return params.get(name);
    }

    // --------- Raum + User aus URL (von FlutterFlow übergeben) ----------
    const roomID = getQueryParam("room") || "testroom";
    const userName = getQueryParam("user") || ("User_" + Math.floor(Math.random() * 100000));
    const userID = String(Math.floor(Math.random() * 1000000000));

    // --------- DEINE ZEGOCLOUD DATEN HIER EINTRAGEN ----------
    // ACHTUNG: appID ist eine Zahl (ohne Anführungszeichen),
    // serverSecret ist eine Zeichenkette (mit Anführungszeichen).
    const appID = 142993488;                 // z.B. 142993488
    const serverSecret = "9e6e26527d4a432184bcb5e173276c22";  // z.B. "9e6e265...276c22"

    // Wenn das Script nicht geladen wurde, gibt es kein ZegoUIKitPrebuilt
    if (typeof ZegoUIKitPrebuilt === "undefined") {
      const root = document.getElementById("root");
      root.innerHTML = '<div class="error">Fehler beim Laden des Voice Rooms<br/>ZEGOCLOUD-SDK konnte nicht geladen werden.<br/>Bitte überprüfe die Internetverbindung und die Script-URL.</div>';
    } else {
      // --------- Token erzeugen (nur für Test) ----------
      // Hinweis: generateKitTokenForTest ist nur für Entwicklung!
      const kitToken = ZegoUIKitPrebuilt.generateKitTokenForTest(
        appID,
        serverSecret,
        roomID,
        userID,
        userName
      );

      // --------- ZEGOCLOUD UIKIT INITIALISIEREN ----------
      const zp = ZegoUIKitPrebuilt.create(kitToken);

      zp.joinRoom({
        container: document.getElementById("root"),

        // Link zum Teilen (später für "Share Room")
        sharedLinks: [
          {
            name: "Room Link",
            url: window.location.href,
          },
        ],

        // Nur Audio, Gruppen-Voice-Room
        scenario: {
          mode: ZegoUIKitPrebuilt.GroupCall,
        },

        // Audio-only Einstellungen
        turnOnCameraWhenJoining: false,
        turnOnMicrophoneWhenJoining: true,
        showMyCameraToggleButton: false,
        showMyMicrophoneToggleButton: true,
        showScreenSharingButton: false,

        // UI-Elemente
        showTextChat: true,              // Chat sichtbar
        showUserList: true,              // Member-Liste sichtbar
        showLeaveRoomConfirmDialog: true,

        // Layout / Sitzplätze – sauberes Rasterlayout
        layout: "Grid",
        maxUsers: 7,                     // Host + 6 Sprecher

        // Direkt rein, ohne Pre-Join
        showPreJoinView: false,
      });
    }
  </script>
</body>
</html>

